#!/usr/bin/env python3
# This file is placed in the Public Domain.
# pylint: disable=C,I,R,W0611,W0212,E0401
# ruff: noqa: E402


"prompt"


import os
import profile
import readline
import sys
import termios


sys.path.insert(0, os.getcwd())


from rssbot.config  import Config
from rssbot.console import Console
from rssbot.errors  import errors
from rssbot.main    import cmnd, enable, init
from rssbot.modules import all as modules
from rssbot.parse   import parse
from rssbot.utils   import forever, modnames
from rssbot.workdir import setwd


Cfg = Config()


def wrap(func):
    "reset console."
    old3 = None
    try:
        old3 = termios.tcgetattr(sys.stdin.fileno())
    except termios.error:
        pass
    try:
        func()
    except (KeyboardInterrupt, EOFError):
        pass
    finally:
        if old3:
            termios.tcsetattr(sys.stdin.fileno(), termios.TCSADRAIN, old3)


def main():
    "main"
    setwd()
    parse(Cfg, " ".join(sys.argv[1:]))
    enable(print)
    if Cfg.txt:
        return cmnd(Cfg.otxt, print)
    csl = Console(print, input)
    if "i" in Cfg.opts:
        init(Cfg.mod, modules)
    csl.start()
    forever()


if __name__ == "__main__":
    wrap(main)
    errors()
