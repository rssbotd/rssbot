#!/usr/bin/env python3
# This file is placed in the Public Domain.


"cli"


import getpass
import os
import sys


from rssbot.command import Commands
from rssbot.config  import Config
from rssbot.errors  import errors
from rssbot.main    import cmnd, enable, wrap
from rssbot.modules import all as modules
from rssbot.parse   import parse
from rssbot.utils   import modnames
from rssbot.workdir import setwd, skel


Cfg = Config()


def srv(event):
    "create service file (pipx)."
    username  = getpass.getuser()
    path = os.path.normpath(f"/home/{username}/.local/bin/")
    txt = f"""[Unit]
Description=24/7 Feed Fetcher
Requires=network-online.target
After=network-online.target

[Service]
User={username}
Group={username}
ExecStart={path}/{Cfg.name}s

[Install]
WantedBy=network.target"""
    event.reply(txt)


def main():
    "main"
    parse(Cfg, " ".join(sys.argv[1:]))
    if Cfg.txt:
        setwd()
        Cfg.mod = ",".join(modnames(modules))
        cmnd(Cfg.otxt, print)


if __name__ == "__main__":
    skel()
    Commands.add(srv)
    enable(print)
    wrap(main)
    errors()
